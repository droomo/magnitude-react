<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        #container {
            display: flex;
            width: 100%;
            height: 100vh;
        }

        #canvasContainer {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>

</head>
<body>
<div id="container">
    <div id="canvasContainer"></div>
</div>

<script src="https://unpkg.com/konva@9/konva.js"></script>
<script src="./js/patch.js"></script>
<script>

    // 笔记本屏幕参数
    // const [widthMM, heightMM] = [343, 215]
    // const [widthPX, heightPX] = [1536, 960]

    // Screen 2
    // 屏幕物理尺寸 mm
    const [widthMM, heightMM] = [597.7, 336.2]
    // 屏幕分辨率 pixel
    const [widthPX, heightPX] = [2560, 1440]

    const calculateCurrentPixel = (px) => {
        // Magic numbers originate from the literature
        return px * ((widthPX / widthMM + heightPX / heightMM) / 2) * ((338 / 1280 + 270 / 1024) / 2)
    }

    const canvas = {
        width: calculateCurrentPixel(240),
        height: calculateCurrentPixel(240),
    }

    const R = calculateCurrentPixel(10)

    const layer = new Konva.Layer();
    const bg = new Konva.Rect({
        x: 0,
        y: 0,
        width: canvas.width,
        height: canvas.height,
        fill: 'rgb(127,127,127)'
    });
    layer.add(bg);
    const stage = new Konva.Stage({
        container: 'canvasContainer',
        ...canvas,
    });
    stage.add(layer);
</script>

<script>
    for (let i = 0; i < 12;) {

        while (1) {
            let fail = false

            let [x, y] = [
                Math.random() * (canvas.width - R * 6) + R * 3,
                Math.random() * (canvas.height - R * 6) + R * 3
            ]
            for (const c of stage.find('CircleI')) {
                const [a, b] = [x - c.x(), y - c.y()]

                if (Math.sqrt(a * a + b * b) < R * 2) {
                    fail = true
                    break
                }
            }
            if (!fail) {
                const circleI = new CircleI({
                    x: x,
                    y: y,
                    radius: R,
                    direction: Math.random() * 2 * Math.PI,
                    fill: 'black',
                    draggable: true,
                });
                layer.add(circleI);
                i++
                break
            }
        }
    }

    const circleIPair = new CircleIPair({
        x: canvas.width / 3,
        y: canvas.height / 3,
        radius: R,
        direction: 1.8 * Math.PI,
        fill: 'black',
        draggable: true,
    });

    // layer.add(circleIPair);

</script>

<script>
    // add the layer to the stage

</script>

</body>
</html>